<!DOCTYPE html>
<html lang="en" class="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nudge v2 — a breathtaking ADHD companion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Space+Grotesk:wght@400;500;600&display=swap"
      rel="stylesheet"
    />
    <script>
      tailwind.config = {
        darkMode: 'class',
        theme: {
          extend: {
            fontFamily: {
              display: ['Outfit', 'ui-sans-serif', 'system-ui'],
              body: ['Space Grotesk', 'ui-sans-serif', 'system-ui'],
            },
            boxShadow: {
              glow: '0 0 40px rgba(99, 102, 241, 0.35), 0 0 120px rgba(56, 189, 248, 0.2)',
            },
          },
        },
      };
    </script>
    <style>
      :root {
        color-scheme: dark;
      }

      body {
        font-family: 'Space Grotesk', system-ui, sans-serif;
      }

      .aurora {
        background: radial-gradient(circle at top left, rgba(56, 189, 248, 0.25), transparent 45%),
          radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.22), transparent 40%),
          radial-gradient(circle at 90% 10%, rgba(236, 72, 153, 0.18), transparent 40%),
          radial-gradient(circle at 80% 70%, rgba(16, 185, 129, 0.15), transparent 45%),
          #05060f;
      }

      .glass {
        backdrop-filter: blur(28px);
        background: linear-gradient(135deg, rgba(15, 23, 42, 0.85), rgba(15, 23, 42, 0.55));
        border: 1px solid rgba(148, 163, 184, 0.15);
      }

      .floating {
        animation: float 12s ease-in-out infinite;
      }

      .floating-slow {
        animation: float 18s ease-in-out infinite;
      }

      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-12px);
        }
      }

      .glow-button {
        position: relative;
        overflow: hidden;
      }

      .glow-button::after {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(120deg, rgba(255, 255, 255, 0.2), transparent 60%);
        transform: translateX(-120%);
        transition: transform 0.6s ease;
      }

      .glow-button:hover::after,
      .glow-button:focus-visible::after {
        transform: translateX(0%);
      }

      .pulse-border {
        box-shadow: 0 0 0 1px rgba(99, 102, 241, 0.35), 0 0 30px rgba(59, 130, 246, 0.2);
      }
    </style>
  </head>
  <body class="aurora min-h-screen text-slate-100">
    <main class="relative mx-auto flex min-h-screen w-full max-w-5xl flex-col px-5 py-12">
      <div class="pointer-events-none absolute inset-0 overflow-hidden">
        <div
          class="floating absolute left-6 top-10 h-32 w-32 rounded-full bg-indigo-500/20 blur-3xl"
        ></div>
        <div
          class="floating-slow absolute right-10 top-32 h-40 w-40 rounded-full bg-emerald-400/20 blur-3xl"
        ></div>
        <div
          class="floating absolute bottom-10 left-1/3 h-48 w-48 rounded-full bg-fuchsia-500/20 blur-3xl"
        ></div>
      </div>

      <section class="relative z-10 mb-10 text-center">
        <p class="text-xs uppercase tracking-[0.5em] text-slate-400">Nudge v2</p>
        <h1 class="mt-3 text-4xl font-semibold tracking-tight text-white sm:text-5xl">
          A breathtaking companion for starting tiny.
        </h1>
        <p class="mx-auto mt-4 max-w-2xl text-base text-slate-300 sm:text-lg">
          Built for bright, overwhelmed brains. We skip guilt, skip pressure, and just make the next
          step feel possible.
        </p>
      </section>

      <section
        id="onboarding"
        class="glass pulse-border relative z-10 space-y-6 rounded-[32px] p-6 shadow-glow sm:p-8"
      >
        <div id="onboarding-step-1" class="space-y-4">
          <p class="font-display text-lg sm:text-xl">Hey, I'm Nudge. What should I call you?</p>
          <input
            id="name-input"
            type="text"
            placeholder="Your name"
            class="w-full rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-indigo-400 focus:outline-none"
          />
          <button
            id="name-next"
            class="glow-button w-full rounded-2xl bg-indigo-500 px-4 py-3 text-base font-semibold text-white transition hover:bg-indigo-400"
          >
            Continue
          </button>
        </div>

        <div id="onboarding-step-2" class="hidden space-y-4">
          <p class="font-display text-lg sm:text-xl" id="struggle-greeting"></p>
          <div class="grid gap-3 sm:grid-cols-2">
            <button class="struggle-option rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-3 text-left text-sm text-slate-200 transition hover:border-indigo-400">
              I know what to do but can't begin
            </button>
            <button class="struggle-option rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-3 text-left text-sm text-slate-200 transition hover:border-indigo-400">
              My brain screams and goes blank
            </button>
            <button class="struggle-option rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-3 text-left text-sm text-slate-200 transition hover:border-indigo-400">
              Every task feels like a mountain
            </button>
            <button class="struggle-option rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-3 text-left text-sm text-slate-200 transition hover:border-indigo-400">
              I freeze and then feel guilty
            </button>
          </div>
          <textarea
            id="struggle-input"
            rows="3"
            placeholder="Or tell me in your own words..."
            class="w-full resize-none rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-indigo-400 focus:outline-none"
          ></textarea>
          <button
            id="struggle-next"
            class="glow-button w-full rounded-2xl bg-indigo-500 px-4 py-3 text-base font-semibold text-white transition hover:bg-indigo-400"
          >
            That’s me
          </button>
        </div>

        <div id="onboarding-step-3" class="hidden space-y-4 text-center">
          <p class="text-lg sm:text-xl">
            Tiny steps only. No lectures. No streaks. You can skip anything, anytime.
          </p>
          <button
            id="onboarding-complete"
            class="glow-button w-full rounded-2xl bg-emerald-400 px-4 py-3 text-base font-semibold text-slate-950 transition hover:bg-emerald-300"
          >
            Let’s make today lighter
          </button>
        </div>
      </section>

      <section id="app" class="relative z-10 mt-10 hidden space-y-6">
        <div class="glass pulse-border rounded-[32px] p-6 shadow-glow sm:p-8">
          <div class="flex flex-col gap-6 sm:flex-row sm:items-center sm:justify-between">
            <div>
              <p class="text-xs uppercase tracking-[0.4em] text-slate-400">Support Mode</p>
              <h2 class="font-display text-2xl sm:text-3xl" id="welcome-message">Hey there.</h2>
              <p class="mt-2 text-slate-300">
                Okay <span id="name-inline"></span>, that sounds big. Let's make it tiny.
              </p>
            </div>
            <div class="w-full max-w-xs space-y-2">
              <label class="text-xs uppercase tracking-[0.3em] text-slate-400">OpenAI API key</label>
              <input
                id="api-key"
                type="password"
                placeholder="sk-..."
                class="w-full rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-2 text-sm text-slate-100 placeholder:text-slate-500 focus:border-indigo-400 focus:outline-none"
              />
              <p class="text-xs text-slate-500">Stored locally in your browser.</p>
            </div>
          </div>
        </div>

        <div class="glass pulse-border rounded-[32px] p-6 shadow-glow sm:p-8">
          <label class="text-xs uppercase tracking-[0.4em] text-slate-400">What are you avoiding?</label>
          <textarea
            id="task-input"
            rows="3"
            placeholder="Example: reply to my professor"
            class="mt-3 w-full resize-none rounded-2xl border border-slate-700/50 bg-slate-900/70 px-4 py-3 text-base text-slate-100 placeholder:text-slate-500 focus:border-indigo-400 focus:outline-none"
          ></textarea>
          <button
            id="breakdown-button"
            class="glow-button mt-4 w-full rounded-2xl bg-indigo-500 px-4 py-3 text-base font-semibold text-white transition hover:bg-indigo-400"
          >
            Break it into tiny steps
          </button>
          <p id="status-message" class="mt-3 text-sm text-slate-400"></p>
        </div>

        <div id="reward-banner" class="hidden rounded-[28px] border border-amber-400/40 bg-amber-500/10 p-6 text-amber-100 shadow-xl"></div>

        <div id="steps-card" class="glass pulse-border hidden rounded-[32px] p-6 shadow-glow sm:p-8">
          <div class="flex items-center justify-between text-xs uppercase tracking-[0.4em] text-slate-400">
            <span>Current tiny step</span>
            <span><span id="step-count">1</span>/<span id="step-total">0</span></span>
          </div>
          <div class="mt-4 text-xl font-semibold sm:text-2xl" id="current-step">Step goes here</div>
          <div class="mt-6 flex flex-col gap-3 sm:flex-row">
            <button
              id="done-button"
              class="glow-button flex-1 rounded-2xl bg-emerald-400 px-4 py-3 text-base font-semibold text-slate-950 transition hover:bg-emerald-300"
            >
              Done
            </button>
            <button
              id="skip-button"
              class="flex-1 rounded-2xl border border-slate-700/60 bg-slate-900/70 px-4 py-3 text-base font-semibold text-slate-200 transition hover:border-indigo-400"
            >
              Skip for now
            </button>
          </div>
          <div class="mt-6 h-3 w-full overflow-hidden rounded-full bg-slate-800">
            <div id="progress-bar" class="h-full w-0 rounded-full bg-emerald-300 transition-all"></div>
          </div>
        </div>

        <div
          id="completion-card"
          class="hidden rounded-[32px] border border-emerald-400/40 bg-emerald-500/10 p-6 text-center text-emerald-100 shadow-xl sm:p-8"
        >
          <h3 class="font-display text-2xl">You did it.</h3>
          <p class="mt-2 text-sm text-emerald-100">
            Every tiny step counts. Come back whenever you want a softer start.
          </p>
        </div>
      </section>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <script>
      const onboarding = document.getElementById('onboarding');
      const onboardingStep1 = document.getElementById('onboarding-step-1');
      const onboardingStep2 = document.getElementById('onboarding-step-2');
      const onboardingStep3 = document.getElementById('onboarding-step-3');
      const nameInput = document.getElementById('name-input');
      const nameNext = document.getElementById('name-next');
      const struggleGreeting = document.getElementById('struggle-greeting');
      const struggleOptions = document.querySelectorAll('.struggle-option');
      const struggleInput = document.getElementById('struggle-input');
      const struggleNext = document.getElementById('struggle-next');
      const onboardingComplete = document.getElementById('onboarding-complete');

      const app = document.getElementById('app');
      const apiKeyInput = document.getElementById('api-key');
      const taskInput = document.getElementById('task-input');
      const breakdownButton = document.getElementById('breakdown-button');
      const statusMessage = document.getElementById('status-message');
      const stepsCard = document.getElementById('steps-card');
      const currentStep = document.getElementById('current-step');
      const stepCount = document.getElementById('step-count');
      const stepTotal = document.getElementById('step-total');
      const doneButton = document.getElementById('done-button');
      const skipButton = document.getElementById('skip-button');
      const progressBar = document.getElementById('progress-bar');
      const completionCard = document.getElementById('completion-card');
      const rewardBanner = document.getElementById('reward-banner');
      const nameInline = document.getElementById('name-inline');
      const welcomeMessage = document.getElementById('welcome-message');

      const state = {
        name: localStorage.getItem('nudge.name') || '',
        struggle: localStorage.getItem('nudge.struggle') || '',
        apiKey: localStorage.getItem('nudge.apiKey') || '',
        steps: [],
        currentIndex: 0,
        rewardMode: 'normal',
      };

      const rewardMessages = {
        extra: "You're not alone in this. We'll keep it tiny and doable.",
        celebration: '',
      };

      const updateWelcome = () => {
        welcomeMessage.textContent = state.name ? `Hey ${state.name}.` : 'Hey there.';
        nameInline.textContent = state.name || 'friend';
      };

      const showOnboardingStep = (step) => {
        onboardingStep1.classList.toggle('hidden', step !== 1);
        onboardingStep2.classList.toggle('hidden', step !== 2);
        onboardingStep3.classList.toggle('hidden', step !== 3);
      };

      const completeOnboarding = () => {
        onboarding.classList.add('hidden');
        app.classList.remove('hidden');
        updateWelcome();
      };

      const init = () => {
        apiKeyInput.value = state.apiKey;
        updateWelcome();

        if (!state.name) {
          showOnboardingStep(1);
          return;
        }
        if (!state.struggle) {
          struggleGreeting.textContent = `Nice to meet you, ${state.name}. What's the paralysis feel like?`;
          showOnboardingStep(2);
          return;
        }
        completeOnboarding();
      };

      nameNext.addEventListener('click', () => {
        const nameValue = nameInput.value.trim();
        if (!nameValue) {
          nameInput.focus();
          return;
        }
        state.name = nameValue;
        localStorage.setItem('nudge.name', state.name);
        struggleGreeting.textContent = `Nice to meet you, ${state.name}. What's the paralysis feel like?`;
        showOnboardingStep(2);
      });

      struggleOptions.forEach((button) => {
        button.addEventListener('click', () => {
          const value = button.textContent.trim();
          struggleInput.value = value;
        });
      });

      struggleNext.addEventListener('click', () => {
        const value = struggleInput.value.trim();
        if (!value) {
          struggleInput.focus();
          return;
        }
        state.struggle = value;
        localStorage.setItem('nudge.struggle', state.struggle);
        showOnboardingStep(3);
      });

      onboardingComplete.addEventListener('click', () => {
        completeOnboarding();
      });

      apiKeyInput.addEventListener('input', (event) => {
        state.apiKey = event.target.value.trim();
        localStorage.setItem('nudge.apiKey', state.apiKey);
      });

      const rollRewardMode = () => {
        const roll = Math.random();
        if (roll < 0.1) return 'celebration';
        if (roll < 0.3) return 'extra';
        return 'normal';
      };

      const buildPrompt = (task, mode) => {
        const base =
          'You are Nudge, a warm, understanding, never-preachy companion for ADHD brains. ' +
          'Break the task into 5-10 micro-steps. Keep each step under 12 words. Output only a numbered list.';
        if (mode === 'extra') {
          return `${base} Add a short, encouraging sentence after the list.`;
        }
        if (mode === 'celebration') {
          return `${base} Include a celebratory tone and reference ${state.name} once.`;
        }
        return base;
      };

      const parseSteps = (content) =>
        content
          .split('\n')
          .map((line) => line.replace(/^\s*\d+[\).\-]*\s*/, '').trim())
          .filter((line) => line.length > 0 && !line.match(/encouraging/i));

      const updateProgress = () => {
        const total = state.steps.length;
        const completed = Math.min(state.currentIndex, total);
        const percent = total ? Math.round((completed / total) * 100) : 0;
        progressBar.style.width = `${percent}%`;
        stepCount.textContent = Math.min(state.currentIndex + 1, total);
        stepTotal.textContent = total;
      };

      const showStep = () => {
        if (!state.steps.length) return;
        if (state.currentIndex >= state.steps.length) {
          stepsCard.classList.add('hidden');
          completionCard.classList.remove('hidden');
          confetti({ particleCount: 120, spread: 70, origin: { y: 0.6 } });
          return;
        }
        currentStep.textContent = state.steps[state.currentIndex];
        stepsCard.classList.remove('hidden');
        completionCard.classList.add('hidden');
        updateProgress();
      };

      const showRewardBanner = () => {
        if (state.rewardMode === 'extra') {
          rewardBanner.textContent = rewardMessages.extra;
          rewardBanner.classList.remove('hidden');
        } else if (state.rewardMode === 'celebration') {
          rewardBanner.textContent = `Celebration mode unlocked. ${state.name}, I'm cheering for you.`;
          rewardBanner.classList.remove('hidden');
        } else {
          rewardBanner.classList.add('hidden');
        }
      };

      const requestBreakdown = async () => {
        const task = taskInput.value.trim();
        if (!task) {
          statusMessage.textContent = 'Tell me what you are avoiding so I can make it tiny.';
          return;
        }
        if (!state.apiKey) {
          statusMessage.textContent = 'Add your OpenAI API key to get a breakdown.';
          return;
        }
        statusMessage.textContent = 'Brewing tiny steps…';
        breakdownButton.disabled = true;
        breakdownButton.classList.add('opacity-70', 'cursor-not-allowed');
        state.rewardMode = rollRewardMode();

        try {
          const response = await fetch('https://api.openai.com/v1/chat/completions', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              Authorization: `Bearer ${state.apiKey}`,
            },
            body: JSON.stringify({
              model: 'gpt-4o-mini',
              messages: [
                { role: 'system', content: buildPrompt(task, state.rewardMode) },
                {
                  role: 'user',
                  content: `Task: ${task}\nParalysis: ${state.struggle}. Keep it gentle and tiny.`,
                },
              ],
              temperature: state.rewardMode === 'celebration' ? 0.7 : 0.5,
            }),
          });

          if (!response.ok) {
            throw new Error('API request failed');
          }

          const data = await response.json();
          const content = data.choices?.[0]?.message?.content || '';
          const steps = parseSteps(content);

          if (!steps.length) {
            throw new Error('No steps returned');
          }

          state.steps = steps;
          state.currentIndex = 0;
          statusMessage.textContent = 'Okay, tiny steps coming right up.';
          showRewardBanner();
          showStep();
        } catch (error) {
          statusMessage.textContent = 'I hit a snag. Double-check your API key and try again.';
          stepsCard.classList.add('hidden');
        } finally {
          breakdownButton.disabled = false;
          breakdownButton.classList.remove('opacity-70', 'cursor-not-allowed');
        }
      };

      breakdownButton.addEventListener('click', requestBreakdown);

      doneButton.addEventListener('click', () => {
        state.currentIndex += 1;
        showStep();
      });

      skipButton.addEventListener('click', () => {
        state.currentIndex += 1;
        showStep();
      });

      init();
    </script>
  </body>
</html>
